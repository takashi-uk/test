name: Start Dev (Scheduled)

on:
  workflow_dispatch:
  schedule:
    - cron: '10 7 * * *'

env:
  AZURE_RESOURCE_GROUP: Common
  AZURE_SERVER_NAME: rosteringdevsvr14
  AZURE_CLUSTER_NAME: rosteringdevcluster

jobs:
  start-db-server:
    name: Start PostgreSQL Flexible Server
    uses: ./.github/workflows/start-db-server.yml
    with:
      azure_resource_group: ${{ inputs.azure_resource_group }}
      azure_server_name: ${{ inputs.azure_server_name }}
    secrets:
      AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}

  start-aks-cluster:
    name: Start AKS Cluster
    needs: start-db-server
    uses: ./.github/workflows/start-aks-cluster.yml
    with:
      azure_resource_group: ${{ inputs.azure_resource_group }}
      azure_cluster_name: ${{ inputs.azure_cluster_name }}
    secrets:
      AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}
